<!-- RadarGun 2.1 benchmark -->
<benchmark xmlns="urn:radargun:benchmark:2.1">

    <!-- The  benchmark will be executed within single JVM -->
    <local/>

    <!-- List of configurations of the services -->
    <configurations>
        <config name="Ehcache 2.5 - local">

            <!-- All slaves use the same configuration -->
            <setup plugin="ehcache25">
                <ehcache xmlns="urn:radargun:plugins:ehcache25:2.1" file="local.xml" cache="testCache" />
            </setup>
        </config>
        <config name="Ehcache 2.6 - local">
            <setup plugin="ehcache26">
                <ehcache xmlns="urn:radargun:plugins:ehcache26:2.1" file="local.xml" cache="testCache" />
            </setup>
        </config>
    </configurations>

    <!-- Sequence of stages executed on the cluster -->
    <scenario>
        <!-- Start services on all nodes -->
        <service-start />
        <!-- Begin monitoring of CPU, memory usage and GC -->
        <jvm-monitor-start />

        <!-- Preload the cache with data -->
        <load-data num-entries="5000">
            <cache-selector>
                <use-cache cache="testCache"  />
            </cache-selector>
        </load-data>

        <!-- 5 threads will execute total of 10,000,000 random requests against the default cache ('testCache')-->
        <!-- As the test is called 'warmup', performance statistics won't be reported -->
        <basic-operations-test test-name="warmup"
                               num-requests="10000000" num-threads-per-node="5">
            <cache-selector>
                <use-cache cache="testCache" />
            </cache-selector>
            <key-selector>
                <concurrent-keys total-entries="5000" />
            </key-selector>
        </basic-operations-test>

        <!-- 10 will execute random requests for 1 minute against the default cache ('testCache') -->
        <basic-operations-test test-name="stress-test"
                               duration="1m" num-threads-per-node="10" get-ratio="5" put-ratio="1" remove-ratio="1" contains-ratio="3">
            <cache-selector>
                <use-cache cache="testCache" />
            </cache-selector>
            <key-selector>
                <concurrent-keys total-entries="5000"/>
            </key-selector>
        </basic-operations-test>

        <conditional-operations-test test-name="cas-stress-test"
                                     duration="1m" num-threads-per-node="10" replace-ratio="">
            <cache-selector>
                <use-cache cache="testCache" />
            </cache-selector>
            <key-selector>
                <concurrent-keys total-entries="5000"/>
            </key-selector>
        </conditional-operations-test>

        <!-- Stop JVM monitoring -->
        <jvm-monitor-stop />
    </scenario>

    <!-- How the statistics are reported -->
    <reports>
        <!-- Produce CSV statistics report -->
        <reporter type="csv"/>
        <!-- Produce HTML statistics report -->
        <reporter type="html"/>
    </reports>

</benchmark>
      